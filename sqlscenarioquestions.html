<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SQL Question & Answer</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }
        .container {
            width: 90%;
            margin: auto;
        }
        h2, h3 {
            color: #333;
        }
        .box {
            background: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 15px;
            font-family: monospace;
        }
        .nav-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        button {
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>

<script>
let currentQuestion = 0;

const questions = [

/* ----------------------------------------------------------
   QUESTION 1 â€” Employee Visit Tracking
   ---------------------------------------------------------- */
{
    question: `
A company tracks employee visits, allowing only one entry per employee per day.
A loophole allows multiple entries using different email IDs.

Determine:
- Total visits
- Most visited floor
- Distinct resources used

Output columns: Name, Total Visits, Most Visited Floor, Used Resources.
`,
    dataset: [
        {name:"Alice", email:"a1@mail.com", floor:2, resources:"Laptop"},
        {name:"Alice", email:"a2@mail.com", floor:2, resources:"Projector"},
        {name:"Bob", email:"bob@mail.com", floor:1, resources:"Printer"},
        {name:"Alice", email:"a1@mail.com", floor:3, resources:"Laptop"},
        {name:"Bob", email:"bob2@mail.com", floor:1, resources:"Laptop"},
        {name:"Charlie", email:"charlie@mail.com", floor:2, resources:"Laptop"},
        {name:"Charlie", email:"charlie@mail.com", floor:2, resources:"Projector"},
        {name:"Alice", email:"a2@mail.com", floor:2, resources:"Whiteboard"}
    ],
    answer: `
WITH floor_rank AS (
    SELECT 
        name,
        floor,
        COUNT(*) AS floor_visit_count,
        RANK() OVER (PARTITION BY name ORDER BY COUNT(*) DESC) AS rn
    FROM resources_data
    GROUP BY name, floor
),
distinct_resources AS (
    SELECT DISTINCT name, resources 
    FROM resources_data
),
resource_list AS (
    SELECT name, STRING_AGG(resources, ',') AS used_resources
    FROM distinct_resources
    GROUP BY name
),
total_visits AS (
    SELECT name, COUNT(*) AS total_visits
    FROM resources_data
    GROUP BY name
)
SELECT 
    FR.name,
    TV.total_visits,
    FR.floor AS most_visited_floor,
    RL.used_resources
FROM floor_rank FR
JOIN total_visits TV ON FR.name = TV.name
JOIN resource_list RL ON FR.name = RL.name
WHERE FR.rn = 1;
`
},

/* ----------------------------------------------------------
   QUESTION 2 â€” Team Match Results
   ---------------------------------------------------------- */
{
    question: `
Using the match result dataset, write a SQL query to:

1. Total matches played  
2. Total wins  
3. Total losses  
4. Display team_name, matches_played, wins, losses  
5. Order by wins desc  
`,
    dataset: [
        {Team_1:"India", Team_2:"SL", Winner:"India"},
        {Team_1:"SL", Team_2:"Aus", Winner:"Aus"},
        {Team_1:"SA", Team_2:"Eng", Winner:"Eng"},
        {Team_1:"Eng", Team_2:"NZ", Winner:"NZ"},
        {Team_1:"Aus", Team_2:"India", Winner:"India"}
    ],

    output: [
        {Team_Name:"India", Matches_played:2, no_of_wins:2, no_of_losses:0},
        {Team_Name:"SL", Matches_played:2, no_of_wins:0, no_of_losses:2},
        {Team_Name:"SA", Matches_played:1, no_of_wins:0, no_of_losses:1},
        {Team_Name:"Eng", Matches_played:2, no_of_wins:1, no_of_losses:1},
        {Team_Name:"Aus", Matches_played:2, no_of_wins:1, no_of_losses:1},
        {Team_Name:"NZ", Matches_played:1, no_of_wins:1, no_of_losses:0}
    ],

    answer: `
WITH team_name AS (
   SELECT team_name, COUNT(*) matches_played FROM (
       SELECT Team_1 AS team_name FROM MatchResults
       UNION ALL
       SELECT Team_2 FROM MatchResults
   ) a GROUP BY team_name
),
no_of_wins AS (
    SELECT team_name, SUM(no_of_wins) AS no_of_wins FROM (
        SELECT Team_1 AS team_name,
               SUM(CASE WHEN Team_1 = Winner THEN 1 ELSE 0 END) AS no_of_wins
        FROM MatchResults GROUP BY Team_1

        UNION ALL

        SELECT Team_2 AS team_name,
               SUM(CASE WHEN Team_2 = Winner THEN 1 ELSE 0 END) AS no_of_wins
        FROM MatchResults GROUP BY Team_2
    ) a GROUP BY team_name
)
SELECT 
    a.team_name,
    a.matches_played,
    b.no_of_wins,
    a.matches_played - b.no_of_wins AS no_of_losses
FROM team_name a
JOIN no_of_wins b ON a.team_name = b.team_name
ORDER BY b.no_of_wins DESC;
`
},
    {
    question: `
Given the daily orders dataset, write a SQL query to determine:

1. How many customers are NEW on each order date  
2. How many customers are REPEAT on each order date  
3. Display order_date, first_visit_flag (new customers), repeat_visit_flag (repeat customers)  
4. Order the results by order_date  
`,

    dataset: [
        {order_id:1, customer_id:100, order_date:"2022-01-01", order_amount:2000},
        {order_id:2, customer_id:200, order_date:"2022-01-01", order_amount:2500},
        {order_id:3, customer_id:300, order_date:"2022-01-01", order_amount:2100},
        {order_id:4, customer_id:100, order_date:"2022-01-02", order_amount:2000},
        {order_id:5, customer_id:400, order_date:"2022-01-02", order_amount:2200},
        {order_id:6, customer_id:500, order_date:"2022-01-02", order_amount:2700},
        {order_id:7, customer_id:100, order_date:"2022-01-03", order_amount:3000},
        {order_id:8, customer_id:400, order_date:"2022-01-03", order_amount:1000},
        {order_id:9, customer_id:600, order_date:"2022-01-03", order_amount:3000}
    ],

    output: [
        {order_date:"2022-01-01", first_visit_flag:3, repeat_visit_flag:0},
        {order_date:"2022-01-02", first_visit_flag:2, repeat_visit_flag:1},
        {order_date:"2022-01-03", first_visit_flag:1, repeat_visit_flag:2}
    ],

    answer: `
SELECT 
    a.order_date,
    SUM(CASE WHEN b.customer_id IS NOT NULL THEN 1 ELSE 0 END) AS first_visit_flag,
    SUM(CASE WHEN b.customer_id IS NULL THEN 1 ELSE 0 END) AS repeat_visit_flag
FROM orders a
LEFT JOIN (
    SELECT customer_id, MIN(order_date) AS first_order_date
    FROM orders
    GROUP BY customer_id
) b 
ON a.customer_id = b.customer_id
AND a.order_date = b.first_order_date
GROUP BY a.order_date
ORDER BY a.order_date;
`
},{
    question: `
Using the daily orders dataset, extend the previous analysis to compute:

1. New customer count per day  
2. Repeat customer count per day  
3. Revenue generated by new customers per day  
4. Revenue generated by repeat customers per day  
5. Display order_date, first_visit, repeat_visit, new_customer_amount, old_customer_amount  
`,

    dataset: [
        {order_id:1, customer_id:100, order_date:"2022-01-01", order_amount:2000},
        {order_id:2, customer_id:200, order_date:"2022-01-01", order_amount:2500},
        {order_id:3, customer_id:300, order_date:"2022-01-01", order_amount:2100},
        {order_id:4, customer_id:100, order_date:"2022-01-02", order_amount:2000},
        {order_id:5, customer_id:400, order_date:"2022-01-02", order_amount:2200},
        {order_id:6, customer_id:500, order_date:"2022-01-02", order_amount:2700},
        {order_id:7, customer_id:100, order_date:"2022-01-03", order_amount:3000},
        {order_id:8, customer_id:400, order_date:"2022-01-03", order_amount:1000},
        {order_id:9, customer_id:600, order_date:"2022-01-03", order_amount:3000}
    ],

    output: [
        {order_date:"2022-01-01", first_visit:3, repeat_visit:0, new_customer_amount:6600, old_customer_amount:0},
        {order_date:"2022-01-02", first_visit:2, repeat_visit:1, new_customer_amount:4900, old_customer_amount:2000},
        {order_date:"2022-01-03", first_visit:1, repeat_visit:2, new_customer_amount:3000, old_customer_amount:4000}
    ],

    answer: `
WITH first_order AS (
    SELECT customer_id, MIN(order_date) AS first_order_date
    FROM orders
    GROUP BY customer_id
),
visits AS (
    SELECT 
        a.order_date,
        SUM(CASE WHEN a.order_date = b.first_order_date THEN 1 ELSE 0 END) AS first_visit,
        SUM(CASE WHEN a.order_date <> b.first_order_date THEN 1 ELSE 0 END) AS repeat_visit
    FROM orders a
    JOIN first_order b
        ON a.customer_id = b.customer_id
    GROUP BY a.order_date
),
amount AS (
    SELECT 
        a.order_date,
        SUM(CASE WHEN a.order_date = b.first_order_date THEN order_amount ELSE 0 END) AS new_customer_amount,
        SUM(CASE WHEN a.order_date <> b.first_order_date THEN order_amount ELSE 0 END) AS old_customer_amount
    FROM orders a
    JOIN first_order b
        ON a.customer_id = b.customer_id
    GROUP BY a.order_date
)
SELECT 
    v.order_date,
    v.first_visit,
    v.repeat_visit,
    a.new_customer_amount,
    a.old_customer_amount
FROM visits v
JOIN amount a ON v.order_date = a.order_date
ORDER BY v.order_date;
`
}



]; // END QUESTIONS ARRAY



/* ----------------------------------------------------------
   RENDER FUNCTION
   ---------------------------------------------------------- */
function renderQuestion(index) {

    let q = questions[index];

    document.getElementById('questionBox').innerHTML = `<p>${q.question}</p>`;

    /* ---- Dataset Table ---- */
    let tableHtml = "<table><tr>";
    Object.keys(q.dataset[0]).forEach(col => tableHtml += `<th>${col}</th>`);
    tableHtml += "</tr>";

    q.dataset.forEach(row => {
        tableHtml += "<tr>";
        Object.values(row).forEach(val => tableHtml += `<td>${val}</td>`);
        tableHtml += "</tr>";
    });
    tableHtml += "</table>";
    document.getElementById('datasetBox').innerHTML = tableHtml;

    /* ---- Expected Output Table ---- */
    if (q.output) {
        let outHtml = "<table><tr>";
        Object.keys(q.output[0]).forEach(col => outHtml += `<th>${col}</th>`);
        outHtml += "</tr>";

        q.output.forEach(row => {
            outHtml += "<tr>";
            Object.values(row).forEach(val => outHtml += `<td>${val}</td>`);
            outHtml += "</tr>";
        });
        outHtml += "</table>";

        document.getElementById("outputBox").innerHTML = outHtml;
    } else {
        document.getElementById("outputBox").innerHTML = "";
    }

    /* ---- SQL Answer ---- */
    document.getElementById('answerBox').innerText = q.answer;
}


/* ----------------------------------------------------------
   Navigation Buttons
   ---------------------------------------------------------- */
function nextQuestion() {
    if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        renderQuestion(currentQuestion);
    } else {
        alert("This is the last question.");
    }
}

function previousQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        renderQuestion(currentQuestion);
    } else {
        alert("This is the first question.");
    }
}

window.onload = function() {
    renderQuestion(currentQuestion);
}
</script>

</head>


<body>
<div class="container">

    <h2>ðŸ“Œ SQL Question</h2>
    <div class="box" id="questionBox"></div>

    <h3>Sample Dataset</h3>
    <div class="box" id="datasetBox"></div>

    <h3>Expected Output</h3>
    <div class="box" id="outputBox"></div>

    <h2>ðŸŸ¢ SQL Answer</h2>
    <div class="box">
        <pre id="answerBox"></pre>
    </div>

    <div class="nav-buttons">
        <button onclick="previousQuestion()">â¬… Previous</button>
        <button onclick="nextQuestion()">Next âž¡</button>
    </div>

</div>
</body>
</html>
