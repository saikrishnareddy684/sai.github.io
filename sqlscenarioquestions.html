<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SQL Scenario Viewer</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        #container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: #fafafa;
        }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
        }
        table {
            border-collapse: collapse;
            margin: 10px 0;
            width: 100%;
        }
        th, td {
            border: 1px solid #999;
            padding: 6px 10px;
            text-align: left;
        }
        .navigation {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 10px 18px;
            margin: 5px;
            border-radius: 8px;
            border: none;
            background: #0078ff;
            color: white;
            cursor: pointer;
        }
        button:disabled {
            background: #999;
        }
    </style>
</head>

<body>

<div id="container">
    <h2 id="scenarioTitle"></h2>
    <div id="scenarioContent"></div>

    <div class="navigation">
        <button id="prevBtn" onclick="prevScenario()">Previous</button>
        <button id="nextBtn" onclick="nextScenario()">Next</button>
    </div>
</div>

<script>
let scenarios = [];
let current = 0;

fetch("scenarios.xml")
    .then(r => r.text())
    .then(xmlText => {
        let parser = new DOMParser();
        let xml = parser.parseFromString(xmlText, "text/xml");

        scenarios = [...xml.getElementsByTagName("SCENARIO")];
        displayScenario(0);
    });

function displayScenario(i) {
    current = i;
    const s = scenarios[i];

    document.getElementById("scenarioTitle").innerHTML =
        "Scenario " + s.getAttribute("id");

    let html = "";

    // QUESTION
    html += `<h3>Question</h3><p>${s.getElementsByTagName("QUESTION")[0].textContent.trim()}</p>`;

    // DATASET
    html += `<h3>Dataset</h3>`;
    let tables = s.getElementsByTagName("TABLE");

    [...tables].forEach(t => {
        html += `<h4>Table: ${t.getAttribute("name")}</h4>`;

        let cols = t.getElementsByTagName("COLUMNS")[0].textContent.split(",");
        let rows = [...t.getElementsByTagName("ROW")].map(r => r.textContent.split(","));

        html += `<table><tr>${cols.map(c => `<th>${c.trim()}</th>`).join("")}</tr>`;

        rows.forEach(r => {
            html += `<tr>${r.map(col => `<td>${col.trim()}</td>`).join("")}</tr>`;
        });

        html += `</table>`;
    });

    // SOLUTION
    html += `<h3>Solution SQL</h3>`;
    let sql = s.getElementsByTagName("SQL")[0].textContent.trim();
    html += `<pre>${sql}</pre>`;

    // NOTES
    html += `<h3>Notes</h3><p>${s.getElementsByTagName("NOTES")[0].textContent.trim()}</p>`;

    document.getElementById("scenarioContent").innerHTML = html;

    // BUTTON STATE
    document.getElementById("prevBtn").disabled = (current === 0);
    document.getElementById("nextBtn").disabled = (current === scenarios.length - 1);
}

function nextScenario() {
    if (current < scenarios.length - 1) displayScenario(current + 1);
}

function prevScenario() {
    if (current > 0) displayScenario(current - 1);
}
</script>

</body>
</html>
