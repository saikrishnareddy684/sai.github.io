<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SQL MCQ Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .question {
      font-size: 1.2em;
      margin-bottom: 15px;
    }
    .options label {
      display: block;
      margin: 8px 0;
      cursor: pointer;
      padding: 8px;
      border-radius: 5px;
      transition: background-color 0.2s ease;
    }
    .options label:hover {
        background-color: #e2f0ff;
    }
    .options input[type="radio"] {
        margin-right: 10px;
    }
    .timer {
      font-weight: bold;
      margin-bottom: 10px;
      color: #d9534f;
    }
    #quizControls {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-top: 20px;
    }
    #quizControls button {
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px; /* Space between buttons */
      margin-bottom: 10px; /* For wrapping on small screens */
      font-size: 1em;
      transition: background-color 0.3s ease, transform 0.2s ease;
      flex-grow: 1; /* Allow buttons to grow */
      min-width: 120px; /* Minimum width for buttons */
    }
    #quizControls button:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
    }
    #quizControls button:active {
        transform: translateY(0);
    }
    #prevBtn {
        background-color: #6c757d; /* Grey for Previous */
    }
    #prevBtn:hover {
        background-color: #5a6268;
    }
    #answerLaterBtn {
        background-color: #ffc107; /* Yellow for Answer Later */
        color: #333;
    }
    #answerLaterBtn:hover {
        background-color: #e0a800;
    }
    #submitBtn {
        background-color: #dc3545; /* Red for Submit */
    }
    #submitBtn:hover {
        background-color: #c82333;
    }
    #result {
      margin-top: 20px;
      background: #e9ffe9;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #c3e6cb;
    }
    #progress {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 10px;
    }
    #restartBtn {
        margin-top: 20px;
        padding: 10px 15px;
        background-color: #28a745; /* Green */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #restartBtn:hover {
        background-color: #218838;
        transform: translateY(-2px);
    }
    #restartBtn:active {
        transform: translateY(0);
    }
    h3, h4 {
        color: #0056b3;
    }
    ul {
        list-style-type: none;
        padding: 0;
    }
    li {
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px dashed #eee;
    }
    li:last-child {
        border-bottom: none;
    }
    .pass {
        color: green;
        font-weight: bold;
    }
    .fail {
        color: red;
        font-weight: bold;
    }
    .question-navigation {
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    .question-numbers {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    .question-number {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background-color: #e9ecef;
        color: #495057;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .question-number:hover {
        transform: translateY(-2px);
    }
    .question-number.answered {
        background-color: #28a745;
        color: white;
    }
    .question-number.unanswered {
        background-color: #dc3545;
        color: white;
    }
    .question-number.current {
        border: 2px solid #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="quiz"></div>
    <div id="quizControls">
        <button id="prevBtn" onclick="goToPreviousQuestion()">Previous</button>
        <button id="nextBtn" onclick="saveAndMoveToNext()">Next</button>
        <button id="answerLaterBtn" onclick="answerLater()">Answer Later</button>
        <button id="submitBtn" onclick="submitQuiz()">Submit Exam</button>
    </div>
    <div id="questionList" class="question-navigation"></div>
    <div id="result"></div>
  </div>

  <script>
    let questions = [ // Changed to 'let' as it will be reassigned after shuffling
      {
        q: "Which SQL command is used to extract data from a database?",
        options: [
          "GET",
          "UPDATE",
          "SELECT",
          "OPEN"
        ],
        answer: 2, // Index of the correct answer (starts at 0)
        time: 20
      },
      {
        q: "Which clause is used to filter records based on a specified condition?",
        options: [
          "CONDITION",
          "FILTER",
          "WHERE",
          "LIMIT"
        ],
        answer: 2,
        time: 20
      },
      {
        q: "Which SQL command is used to add new rows of data to a table?",
        options: [
          "ADD ROW",
          "INSERT INTO",
          "CREATE NEW",
          "UPDATE"
        ],
        answer: 1,
        time: 20
      },
      {
        q: "What does the acronym SQL stand for?",
        options: [
          "Structured Question Language",
          "Standard Query Logic",
          "Simple Query Language",
          "Structured Query Language"
        ],
        answer: 3,
        time: 20
      },
      {
        q: "Which operator is used to search for a specified pattern in a column?",
        options: [
          "PATTERN",
          "LIKE",
          "MATCH",
          "COMPARE"
        ],
        answer: 1,
        time: 20
      },
      {
        q: "Which type of JOIN returns only the rows that have matching values in both tables?",
        options: [
          "FULL JOIN",
          "LEFT JOIN",
          "INNER JOIN",
          "OUTER JOIN"
        ],
        answer: 2,
        time: 20
      },
      {
        q: "Which SQL command is used to change existing data in a table?",
        options: [
          "MODIFY",
          "CHANGE",
          "ALTER",
          "UPDATE"
        ],
        answer: 3,
        time: 20
      },
      {
        q: "Which keyword is used to sort the result-set of a query?",
        options: [
          "SORT BY",
          "ARRANGE BY",
          "GROUP BY",
          "ORDER BY"
        ],
        answer: 3,
        time: 20
      },
      {
        q: "A table must have a column defined as a _________ to uniquely identify each record.",
        options: [
          "Foreign Key",
          "Candidate Key",
          "Primary Key",
          "Unique Key"
        ],
        answer: 2,
        time: 20
      },
      {
        q: "Which function is used to count the number of rows in a table?",
        options: [
          "SUM()",
          "COUNT()",
          "NUMBER()",
          "ROWS()"
        ],
        answer: 1,
        time: 20
      }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null); // Stores the index of the selected option, or null if unanswered
    let globalTimerInterval; // Global timer interval ID
    let totalSecondsLeft; // Total time for the entire quiz
    const passPercentage = 70; // Define the passing percentage
    const timePerQuestion = 20; // 20 seconds per question

    // Function to shuffle an array (Fisher-Yates algorithm)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // Swap elements
        }
    }

    // Function to shuffle options for a single question and update its answer index
    function shuffleOptionsAndAnswer(question) {
        const correctOptionText = question.options[question.answer];
        shuffleArray(question.options); // Shuffle the options array
        question.answer = question.options.indexOf(correctOptionText); // Update the answer index
    }

    function calculateCorrectAnswers() {
        let count = 0;
        for (let i = 0; i < questions.length; i++) {
            if (userAnswers[i] !== null && userAnswers[i] === questions[i].answer) {
                count++;
            }
        }
        return count;
    }

    function saveCurrentAnswer() {
        const selected = document.querySelector("input[name='option']:checked");
        if (selected) {
            userAnswers[currentQuestionIndex] = parseInt(selected.value);
        } else {
            // If no option is selected, and it wasn't marked "Answer Later", keep it null
            // If it was previously answered, and now unselected, set to null
            if (userAnswers[currentQuestionIndex] !== null) {
                userAnswers[currentQuestionIndex] = null;
            }
        }
    }

    function loadQuestion(index) {
        // No clearInterval(timer) here, as globalTimerInterval is managed separately
        document.getElementById("result").innerHTML = ""; // Clear results area

        if (index >= questions.length) {
            submitQuiz();
            return;
        }

        currentQuestionIndex = index; // Ensure currentQuestionIndex is updated for direct jumps

        const q = questions[currentQuestionIndex];
        
        // Format global time for display
        const minutes = Math.floor(totalSecondsLeft / 60);
        const seconds = totalSecondsLeft % 60;
        const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        // Removed the currentCorrectCount from progressHTML
        const progressHTML = `<div id="progress">Question ${currentQuestionIndex + 1} of ${questions.length}</div>`;

        document.getElementById("quiz").innerHTML = `
            ${progressHTML}
            <div class="timer">Total Time Left: <span id="timer">${formattedTime}</span></div>
            <div class="question">Q${currentQuestionIndex + 1}. ${q.q}</div>
            <div class="options">
                ${q.options.map((opt, i) => `
                    <label>
                        <input type="radio" name="option" value="${i}" ${userAnswers[currentQuestionIndex] === i ? 'checked' : ''}> ${opt}
                    </label>
                `).join('')}
            </div>
        `;

        // Update button visibility
        document.getElementById("prevBtn").disabled = currentQuestionIndex === 0;
        document.getElementById("nextBtn").style.display = currentQuestionIndex === questions.length - 1 ? "none" : "inline-block";
        document.getElementById("submitBtn").style.display = "inline-block";
        document.getElementById("answerLaterBtn").style.display = currentQuestionIndex === questions.length - 1 ? "none" : "inline-block";
        
        updateQuestionList(); // Update the navigation list
        console.log(`Loaded question ${currentQuestionIndex + 1}. Total time left: ${formattedTime}`);
    }

    function saveAndMoveToNext() {
        saveCurrentAnswer(); // Save the answer for the current question

        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
        } else {
            submitQuiz(); // If it's the last question, submit
        }
    }

    function goToPreviousQuestion() {
        saveCurrentAnswer(); // Save the answer for the current question

        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            loadQuestion(currentQuestionIndex);
        }
    }

    function answerLater() {
        // Explicitly mark as unanswered (null)
        userAnswers[currentQuestionIndex] = null; 
        saveAndMoveToNext(); // Move to the next question
    }

    function submitQuiz() {
        clearInterval(globalTimerInterval); // Stop the global timer
        saveCurrentAnswer(); // Save the answer for the current question before final submission

        console.log("Submitting quiz. Final answers:", userAnswers);
        showResult();
    }

    function showResult() {
        let finalScore = calculateCorrectAnswers();
        let totalQuestions = questions.length;
        let scorePercentage = (finalScore / totalQuestions) * 100;

        let resultHTML = "<h3>Quiz Completed!</h3>";
        resultHTML += `<h4>Your Final Score: ${finalScore} / ${totalQuestions}</h4>`;
        resultHTML += `<h4>Your Percentage: ${scorePercentage.toFixed(2)}%</h4>`;

        if (scorePercentage >= passPercentage) {
            resultHTML += `<h4 class="pass">Congratulations! You Passed!</h4>`;
        } else {
            resultHTML += `<h4 class="fail">Sorry, you did not pass. Try again!</h4>`;
        }
        
        resultHTML += "<h3>Detailed Review:</h3><ul>";

        questions.forEach((q, i) => {
            const userAnswer = userAnswers[i];
            const correctOptionIndex = q.answer;
            const correctText = q.options[correctOptionIndex];
            const userText = userAnswer !== null ? q.options[userAnswer] : "(Not Answered)";
            const isCorrect = (userAnswer === correctOptionIndex);

            resultHTML += `<li>
                <strong>Q${i + 1}:</strong> ${q.q}<br>
                Your Answer: <span style="color: ${isCorrect ? 'green' : 'red'};">${userText}</span><br>
                Correct Answer: <span style="color: green;">${correctText}</span>
            </li><br>`;
        });

        resultHTML += `</ul>`;
        resultHTML += `<button id="restartBtn" onclick="location.reload()">Restart Quiz</button>`;

        document.getElementById("quiz").style.display = "none";
        document.getElementById("quizControls").style.display = "none";
        document.getElementById("questionList").style.display = "none"; // Hide question list on result
        document.getElementById("result").innerHTML = resultHTML;
    }

    function updateQuestionList() {
        const questionListDiv = document.getElementById("questionList");
        let listHTML = "<h4>Question Navigation:</h4><div class='question-numbers'>";
        questions.forEach((q, i) => {
            let statusClass = '';
            if (userAnswers[i] !== null) {
                statusClass = 'answered';
            } else if (userAnswers[i] === null && i < currentQuestionIndex) {
                // If they skipped or went back, and it's still null, it's unanswered
                statusClass = 'unanswered';
            } else if (userAnswers[i] === null && i > currentQuestionIndex) {
                statusClass = ''; // Future questions, default color
            }
            
            const currentClass = i === currentQuestionIndex ? 'current' : '';
            listHTML += `<span class='question-number ${statusClass} ${currentClass}' onclick='jumpToQuestion(${i})'>${i + 1}</span>`;
        });
        listHTML += "</div>";
        questionListDiv.innerHTML = listHTML;
    }

    function jumpToQuestion(index) {
        // No clearInterval(timer) here, as globalTimerInterval is managed separately
        saveCurrentAnswer(); // Save the answer for the question they are leaving
        loadQuestion(index); // Load the new question
    }

    // Initial setup: Shuffle questions, calculate total time, start global timer, and then load the first one
    shuffleArray(questions); // Shuffle the order of questions
    // For each question, shuffle its options and update the correct answer index
    questions.forEach(q => shuffleOptionsAndAnswer(q));

    totalSecondsLeft = questions.length * timePerQuestion; // Calculate total time

    // Start the global timer
    globalTimerInterval = setInterval(() => {
        totalSecondsLeft--;
        const minutes = Math.floor(totalSecondsLeft / 60);
        const seconds = totalSecondsLeft % 60;
        const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        const timerElement = document.getElementById("timer");
        if (timerElement) {
            timerElement.textContent = formattedTime;
        }

        if (totalSecondsLeft <= 0) {
            submitQuiz(); // Automatically submit when time runs out
        }
    }, 1000);

    loadQuestion(currentQuestionIndex);
  </script>
</body>
</html>
