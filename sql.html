<script>
    // --- 171 SQL Questions Array Generated from the file ---
    // NOTE: The array below is only a partial snippet (first 22 questions) 
    // for demonstration. You must ensure your actual file has the full 
    // array with all 171 questions here!
    let questions = [
      {
            "q": "Can we add a column with identity in existing table",
            "options": [
                  "Yes, by using the `ALTER COLUMN` command directly.",
                  "No, the operation is restricted or requires an alternative approach.",
                  "No, because it would violate the referential integrity.",
                  "You must drop and recreate the database."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "Can we add a column with not null in existing table",
            "options": [
                  "No, because it would violate the referential integrity.",
                  "Yes, by using the `ALTER COLUMN` command directly.",
                  "Yes, but a `DEFAULT` value must be provided for the existing rows.",
                  "You must drop and recreate the database."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "How to Creating an Incrementing Sequence Object in SQL Server:",
            "options": [
                  "You must use an `IDENTITY` column to generate sequential numbers.",
                  "The command to restart is `RESET SEQUENCE`.",
                  "Sequence values are only generated during table creation.",
                  "A SEQUENCE in SQL Server is a database object that generates a sequence of numeric values in order."
            ],
            "answer": 3,
            "time": 20
      },
      {
            "q": "How to Alter the object to reset the sequence value:",
            "options": [
                  "You must drop and recreate the database.",
                  "You must use an `IDENTITY` column to generate sequential numbers.",
                  "ALTER SEQUENCE dbo.SequenceObject RESTART WITH 1 is the correct command.",
                  "The command to restart is `RESET SEQUENCE`."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "questions on sequence",
            "options": [
                  "The command to restart is `RESET SEQUENCE`.",
                  "The command is unsupported and results in an error.",
                  "The DROP SEQUENCE command.",
                  "The solution is to use the `ROLLBACK` command."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "What is Clustered Index, a clustered index is a special type of index that physically stores and sorts the data rows in a table or view based on their key values. Because the data rows themselves are stored in sorted order, there can be only **one clustered index per table**.",
            "options": [
                  "A clustered index allows up to 5 indexes per table.",
                  "It dictates the physical, sorted storage order of the data rows.",
                  "The index is stored in memory (RAM) only.",
                  "The index structure is a Hash Table (Hash map)."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "What is max number of Clustered Index on a table",
            "options": [
                  "The value is stored in the master database.",
                  "The maximum limit is 16 per table.",
                  "Only one clustered index is allowed per table.",
                  "A clustered index allows up to 5 indexes per table."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "What is Page Split",
            "options": [
                  "The operation of moving half the rows from a full page to a new page to make room for insertions.",
                  "Page splits only occur during SELECT operations.",
                  "A page split is an error that corrupts the database.",
                  "The solution is to use the `ROLLBACK` command."
            ],
            "answer": 0,
            "time": 20
      },
      {
            "q": "What is Physical Structure of Clustered Index,",
            "options": [
                  "The index structure is a Hash Table (Hash map).",
                  "It is called a B-tree Hash map.",
                  "A B-Tree is the correct structure.",
                  "The functionality is reserved for Enterprise Edition only."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "What is Non-Clustered Index,",
            "options": [
                  "It dictates the physical, sorted storage order of the data rows.",
                  "It contains key values and row pointers, separate from the data.",
                  "A non-clustered index is stored in the same location as the data.",
                  "The command is unsupported and results in an error."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "How many Non-clustered Index can we have per table?",
            "options": [
                  "A non-clustered index is stored in the same location as the data.",
                  "Only one clustered index is allowed per table.",
                  "You must drop and recreate the database.",
                  "A table can have a maximum of 999 non-clustered indexes."
            ],
            "answer": 3,
            "time": 20
      },
      {
            "q": "What is Index fragmentation,",
            "options": [
                  "It is a feature related to distributed transactions only.",
                  "The index is stored in memory (RAM) only.",
                  "A condition where index data pages are scattered and not logically ordered, degrading performance.",
                  "It is the process of physically deleting the database file."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "What is difference between Index Rebuild and Index Reorganize.",
            "options": [
                  "Rebuild is online and faster, Reorganize is offline and slower.",
                  "Rebuild creates a new index and drops the old one; Reorganize physically reorders the leaf-level pages in place.",
                  "The solution is to use the `ROLLBACK` command.",
                  "Reorganize creates a new index and drops the old one; Rebuild physically reorders the leaf-level pages in place."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "What is Fill Factor in SQL Server index,",
            "options": [
                  "Fill factor only applies to the root node of the index.",
                  "It is a value from 0 to 100 that specifies the percentage of space to leave empty on each leaf-level page.",
                  "The functionality is reserved for Enterprise Edition only.",
                  "It specifies the maximum number of columns an index can contain."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "What is Covered Index in SQL Server?",
            "options": [
                  "An index that includes all the columns requested in the query, allowing the query to complete without looking up the data row.",
                  "It is a feature related to distributed transactions only.",
                  "The index is stored in memory (RAM) only.",
                  "The index structure is a Hash Table (Hash map)."
            ],
            "answer": 0,
            "time": 20
      },
      {
            "q": "What is the key difference between Truncate and Delete command in SQL Server?",
            "options": [
                  "DELETE is DDL and TRUNCATE is DML.",
                  "TRUNCATE is a DML command; DELETE is a DDL command.",
                  "DELETE is faster and doesn't use the transaction log; TRUNCATE is slower and uses the log.",
                  "TRUNCATE is DDL, logs minimal info, resets identity, and is faster; DELETE is DML, logs every row deletion, and is slower."
            ],
            "answer": 3,
            "time": 20
      },
      {
            "q": "What is difference between where and having in SQL Server?",
            "options": [
                  "`WHERE` is used for row filtering before aggregation; `HAVING` is used for group filtering after aggregation.",
                  "`HAVING` is faster than `WHERE` and is used only on indexed columns.",
                  "It is not possible in SQL Server.",
                  "`WHERE` is used for filtering data after aggregation; `HAVING` is used for filtering before aggregation."
            ],
            "answer": 0,
            "time": 20
      },
      {
            "q": "What is stored procedure in SQL Server?",
            "options": [
                  "A temporary object that holds data only for the current session.",
                  "A precompiled set of one or more SQL statements stored in the database.",
                  "The functionality is reserved for Enterprise Edition only.",
                  "An index that includes all the columns requested in the query."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "What is the key difference between stored procedure and function in SQL Server?",
            "options": [
                  "Functions can modify data and cannot be used in `SELECT` statements; Procedures can only return a single value.",
                  "Stored procedures can modify data and return 0 or more values; Functions cannot modify data (usually) and return a single value/table.",
                  "The command is unsupported and results in an error.",
                  "Functions can modify data; Procedures are read-only."
            ],
            "answer": 1,
            "time": 20
      },
      {
            "q": "What is difference between local temporary table and global temporary table?",
            "options": [
                  "Local temporary tables are visible to all sessions; Global temporary tables are visible only to the session that created them.",
                  "Local tables are prefixed with `##` and are session-specific; Global tables are prefixed with `#` and are visible to all sessions.",
                  "Local tables are prefixed with `#` and are session-specific; Global tables are prefixed with `##` and are visible to all sessions.",
                  "It is only available in older SQL Server versions."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "How to create a global temporary table:",
            "options": [
                  "CREATE GLOBAL TABLE #TableName",
                  "CREATE TABLE ##TableName",
                  "It is not possible in SQL Server.",
                  "CREATE TABLE ##TableName (Col1 INT)"
            ],
            "answer": 3,
            "time": 20
      },
      {
            "q": "What is the key difference between Table Variable and Temporary Table?",
            "options": [
                  "Table variables are stored in the `tempdb` database; Temporary tables are stored in memory.",
                  "Table variables are session-specific; Temporary tables are visible to all sessions.",
                  "Table variables do not support indexes and are used within a single batch/SP; Temporary tables support indexes and can be retained longer.",
                  "The functionality is reserved for Enterprise Edition only."
            ],
            "answer": 2,
            "time": 20
      },
      {
            "q": "What is difference between UNION and UNION ALL?",
            "options": [
                  "UNION removes duplicate rows and performs sorting, making it slower; UNION ALL includes all rows, including duplicates, and is faster.",
                  "UNION can only combine two columns, while UNION ALL can combine any number.",
                  "The functionality is reserved for Enterprise Edition only.",
                  "UNION is DDL, logs minimal info; UNION ALL is DML, logs every row."
            ],
            "answer": 0,
            "time": 20
      },
      // ... (Ensure all 171 questions are included here)
    
    ];
    // --- End of 171 SQL Questions Array ---
    
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let timer;
    const quizContainer = document.getElementById('quiz');
    const resultContainer = document.getElementById('result');
    const questionListContainer = document.getElementById('questionList');
    
    // Initialize user answers array
    for (let i = 0; i < questions.length; i++) {
        userAnswers.push({ selectedOption: null, answeredLater: false, timeRemaining: questions[i].time });
    }

    /**
     * Renders the current question and its options to the quiz container.
     */
    function renderQuestion() {
        resultContainer.innerHTML = '';
        const qData = questions[currentQuestionIndex];
        const currentAnswer = userAnswers[currentQuestionIndex].selectedOption;
        const totalQuestions = questions.length;
        
        let html = `<div id="progress">Question ${currentQuestionIndex + 1} of ${totalQuestions}</div>`;
        html += `<div class="timer" id="timeRemaining">Time: ${userAnswers[currentQuestionIndex].timeRemaining}s</div>`;
        html += `<div class="question">Q${currentQuestionIndex + 1}. ${qData.q}</div>`;
        html += '<div class="options">';

        qData.options.forEach((option, index) => {
            const isChecked = currentAnswer === index ? 'checked' : '';
            html += `
                <label>
                    <input type="radio" name="question${currentQuestionIndex}" value="${index}" ${isChecked}>
                    ${option}
                </label>
            `;
        });
        
        html += '</div>';
        quizContainer.innerHTML = html;
        
        updateQuestionNavigation();
        startTimer();
        updateControlButtons();
    }

    /**
     * Manages the countdown timer for the current question.
     */
    function startTimer() {
        clearInterval(timer);
        
        let time = userAnswers[currentQuestionIndex].timeRemaining;
        const timeDisplay = document.getElementById('timeRemaining');

        timer = setInterval(() => {
            time--;
            userAnswers[currentQuestionIndex].timeRemaining = time;
            timeDisplay.textContent = `Time: ${time}s`;

            if (time <= 0) {
                clearInterval(timer);
                saveAndMoveToNext(); // Move to the next question automatically
            }
        }, 1000);
    }
    
    /**
     * Saves the user's current selection and moves to the next question.
     */
    function saveAndMoveToNext() {
        saveAnswer();
        clearInterval(timer);
        
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
        } else {
            // If it's the last question, show an alert or submit the quiz
            alert("You have reached the end of the quiz! Please click 'Submit Exam'.");
        }
    }

    /**
     * Moves to the previous question.
     */
    function goToPreviousQuestion() {
        saveAnswer();
        clearInterval(timer);
        
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderQuestion();
        }
    }
    
    /**
     * Saves the current selected radio button value into the userAnswers array.
     */
    function saveAnswer() {
        const selectedOption = document.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
        if (selectedOption) {
            // Save the index of the selected option
            userAnswers[currentQuestionIndex].selectedOption = parseInt(selectedOption.value);
            userAnswers[currentQuestionIndex].answeredLater = false;
        } else {
            // If nothing is selected, ensure it's recorded as null/unanswered
            userAnswers[currentQuestionIndex].selectedOption = null;
            userAnswers[currentQuestionIndex].answeredLater = false;
        }
    }
    
    /**
     * Flags the current question for review and moves to the next one.
     */
    function answerLater() {
        saveAnswer(); // Save the current (possibly null) selection first
        userAnswers[currentQuestionIndex].answeredLater = true;
        saveAndMoveToNext();
    }

    /**
     * Updates the state of the Previous/Next buttons.
     */
    function updateControlButtons() {
        document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
        // The Next button will automatically move to next or alert at the end
    }

    /**
     * Renders the navigation panel with question numbers.
     */
    function updateQuestionNavigation() {
        let html = '<h4>Question Navigation</h4><div class="question-numbers">';
        
        questions.forEach((_, index) => {
            let classes = 'question-number';
            
            if (index === currentQuestionIndex) {
                classes += ' current';
            } else if (userAnswers[index].selectedOption !== null && userAnswers[index].answeredLater === false) {
                classes += ' answered';
            } else if (userAnswers[index].answeredLater === true) {
                classes += ' unanswered'; // Using unanswered class for "Answer Later" (red)
            }

            html += `<div class="${classes}" onclick="goToQuestion(${index})">${index + 1}</div>`;
        });

        html += '</div>';
        questionListContainer.innerHTML = html;
    }

    /**
     * Jumps directly to a specific question.
     */
    function goToQuestion(index) {
        saveAnswer();
        clearInterval(timer);
        currentQuestionIndex = index;
        renderQuestion();
    }

    /**
     * Submits the quiz and displays the final score and results.
     */
    function submitQuiz() {
        saveAnswer(); // Save the final answer
        clearInterval(timer);
        
        let score = 0;
        let resultsHtml = '<h3>Quiz Results</h3><ul>';
        
        questions.forEach((qData, index) => {
            const userAnswer = userAnswers[index].selectedOption;
            const isCorrect = userAnswer === qData.answer;
            
            if (isCorrect) {
                score++;
            }
            
            const userSelection = userAnswer !== null ? qData.options[userAnswer] : 'Not Answered';
            const statusClass = isCorrect ? 'pass' : 'fail';
            
            resultsHtml += `
                <li>
                    <h4>Q${index + 1}: ${qData.q}</h4>
                    <p>Your Answer: ${userSelection} (${userAnswer !== null ? (isCorrect ? '<span class="pass">Correct</span>' : '<span class="fail">Incorrect</span>') : 'Unanswered'})</p>
                    <p>Correct Answer: ${qData.options[qData.answer]}</p>
                </li>
            `;
        });
        
        resultsHtml += `</ul>`;
        
        const finalScoreHtml = `<h2>Final Score: ${score} / ${questions.length} (${((score / questions.length) * 100).toFixed(2)}%)</h2>`;
        
        quizContainer.innerHTML = finalScoreHtml;
        resultContainer.innerHTML = resultsHtml;
        questionListContainer.innerHTML = '';
        
        // Show restart button
        document.getElementById('quizControls').style.display = 'none';
        quizContainer.insertAdjacentHTML('beforeend', '<button id="restartBtn" onclick="restartQuiz()">Restart Quiz</button>');
    }

    /**
     * Resets the quiz to start from the beginning.
     */
    function restartQuiz() {
        currentQuestionIndex = 0;
        userAnswers = [];
        for (let i = 0; i < questions.length; i++) {
            userAnswers.push({ selectedOption: null, answeredLater: false, timeRemaining: questions[i].time });
        }
        
        document.getElementById('quizControls').style.display = 'flex';
        document.getElementById('restartBtn').remove();
        loadQuiz();
    }

    /**
     * Initializes the quiz on page load.
     */
    function loadQuiz() {
        if (questions.length > 0) {
            renderQuestion();
        } else {
            quizContainer.innerHTML = "No questions found. Please check the 'questions' array.";
            document.getElementById('quizControls').style.display = 'none';
        }
    }

    // Start the quiz when the page loads
    window.onload = loadQuiz;
  </script>
