<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SQL Question & Answer â€” Full</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #222;
        }
        .container {
            width: 95%;
            max-width: 1100px;
            margin: 0 auto;
        }
        h1 { margin: 0 0 8px; font-size: 22px; }
        h2 { margin: 18px 0 6px; font-size: 18px; color: #333; }
        h3 { margin: 8px 0; font-size: 16px; color: #333; }
        .box {
            background: white;
            padding: 18px;
            margin-top: 14px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.06);
        }
        .jump-buttons {
            margin-bottom: 12px;
        }
        .jump-buttons button {
            background-color: #008CBA;
            color: white;
            border: none;
            padding: 8px 12px;
            margin-right: 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        .jump-buttons button:hover { background-color: #007399; }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }
        table, th, td { border: 1px solid #ddd; }
        th, td { padding: 8px; text-align: left; font-size: 13px; }
        th { background: #fafafa; }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 14px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.45;
        }
        .nav-buttons {
            margin-top: 14px;
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }
        .nav-controls button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        .nav-controls button:hover { background-color: #45a049; }
        .small-muted { color: #666; font-size: 13px; margin-top: 6px; }
    </style>
</head>
<body>
<div class="container">
    <h1>ðŸ“š SQL Questions & Answers</h1>
    <div class="small-muted">Click any question button to jump directly to that question. Buttons are auto-generated from the `questions` array â€” add new question objects there and a button appears automatically.</div>

    <!-- Jump buttons (auto-generated) -->
    <div id="jumpButtons" class="jump-buttons"></div>

    <!-- Question area -->
    <div id="questionBox" class="box"></div>

    <h3>Sample Dataset</h3>
    <div id="datasetBox" class="box"></div>
    
  <h3>Sample Dataset</h3>
    <div id="datasetBox2" class="box"></div>

    <h3>Sample Dataset</h3>
    <div id="datasetBox3" class="box"></div>
    
  <h3>Expected Output</h3>
    <div id="outputBox" class="box"></div>

    <h2>ðŸŸ¢ SQL Answer</h2>
    <div class="box">
        <pre id="answerBox"></pre>
    </div>

    <div class="nav-buttons">
        <div class="nav-controls">
            <button id="prevBtn">â¬… Previous</button>
            <button id="nextBtn">Next âž¡</button>
        </div>
        <div class="small-muted" id="questionCounter"></div>
    </div>
</div>

<script>
/* ============================
   QUESTIONS ARRAY (6 questions)
   Keep the same object format when adding new questions.
   Buttons will be generated automatically.
   ============================ */
const questions = [

/* QUESTION 1 â€” Employee Visit Tracking */
{
    question: `
A company tracks employee visits, allowing only one entry per employee per day.
A loophole allows multiple entries using different email IDs.

Determine:
- Total visits
- Most visited floor
- Distinct resources used

Output columns: Name, Total Visits, Most Visited Floor, Used Resources.
`,
    dataset: [
        {name:"A    ", address:"Bangalore", email:"A@gmail.com  ", floor:"1    ", resources:"CPU     "},
        {name:"A    ", address:"Bangalore", email:"A1@gmail.com ", floor:"1    ", resources:"CPU     "},
        {name:"A    ", address:"Bangalore", email:"A2@gmail.com ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B@gmail.com  ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B1@gmail.com ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B2@gmail.com ", floor:"1    ", resources:"MONITOR "}
    ],
  dataset2: [
        {name:"A    ", address:"Bangalore", email:"A@gmail.com  ", floor:"1    ", resources:"CPU     "},
        {name:"A    ", address:"Bangalore", email:"A1@gmail.com ", floor:"1    ", resources:"CPU     "},
        {name:"A    ", address:"Bangalore", email:"A2@gmail.com ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B@gmail.com  ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B1@gmail.com ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B2@gmail.com ", floor:"1    ", resources:"MONITOR "}
    ],
    dataset3: [ ],
    output: [
        {name:"A    ", total_visits:"3", most_visited_floor:"1    ", resources_used:"CPU,DESKTOP   "},
        {name:"B    ", total_visits:"3", most_visited_floor:"2    ", resources_used:"DESKTOP,MONITOR"}
    ],
    answer: `
WITH floor_rank AS (
    SELECT 
        name,
        floor,
        COUNT(*) AS floor_visit_count,
        RANK() OVER (PARTITION BY name ORDER BY COUNT(*) DESC) AS rn
    FROM resources_data
    GROUP BY name, floor
),
distinct_resources AS (
    SELECT DISTINCT name, resources 
    FROM resources_data
),
resource_list AS (
    SELECT name, STRING_AGG(resources, ',') AS used_resources
    FROM distinct_resources
    GROUP BY name
),
total_visits AS (
    SELECT name, COUNT(*) AS total_visits
    FROM resources_data
    GROUP BY name
)
SELECT 
    FR.name,
    TV.total_visits,
    FR.floor AS most_visited_floor,
    RL.used_resources
FROM floor_rank FR
JOIN total_visits TV ON FR.name = TV.name
JOIN resource_list RL ON FR.name = RL.name
WHERE FR.rn = 1;
`
} 

    
/* End of questions array */
];

/* ============================
   UI & Rendering Helpers
   ============================ */

let currentQuestion = 0;

function createJumpButtons() {
    const container = document.getElementById('jumpButtons');
    container.innerHTML = '';
    questions.forEach((q, idx) => {
        const btn = document.createElement('button');
        btn.textContent = 'Q' + (idx + 1);
        btn.title = 'Go to Question ' + (idx + 1);
        btn.onclick = () => {
            currentQuestion = idx;
            renderQuestion(idx);
        };
        container.appendChild(btn);
    });
}

function renderTableFromObjects(list) {
    if (!list || list.length === 0) return '';
    const cols = Object.keys(list[0]);
    let html = '<table><thead><tr>';
    cols.forEach(c => html += `<th>${c}</th>`);
    html += '</tr></thead><tbody>';
    list.forEach(r => {
        html += '<tr>';
        cols.forEach(c => html += `<td>${r[c]}</td>`);
        html += '</tr>';
    });
    html += '</tbody></table>';
    return html;
}

function renderQuestion(index) {
    const q = questions[index];
    // Question text
    document.getElementById('questionBox').innerHTML = `<h3>Question ${index + 1}</h3><p>${q.question.replace(/\n\s+/g,'\n')}</p>`;

    // Dataset
    const datasetHtml = q.dataset && q.dataset.length ? renderTableFromObjects(q.dataset) : '<p>No dataset for this question.</p>';
    document.getElementById('datasetBox').innerHTML = datasetHtml;
// Dataset3
    const datasetHtml2 = q.dataset2 && q.dataset2.length ? renderTableFromObjects(q.dataset2) : '<p>No dataset for this question.</p>';
    document.getElementById('datasetBox2').innerHTML = datasetHtml2;

    // Dataset3
    const datasetHtml3 = q.dataset3 && q.dataset3.length ? renderTableFromObjects(q.dataset3) : '<p>No dataset for this question.</p>';
    document.getElementById('datasetBox3').innerHTML = datasetHtml3;

    // Output
    const outputHtml = q.output && q.output.length ? renderTableFromObjects(q.output) : '<p>No output for this question.</p>';
    document.getElementById('outputBox').innerHTML = outputHtml;

    // Answers: combine answer, answer_1, answer_2, explanation
    let answerText = '';
    if (q.answer) answerText += q.answer.trim() + '\n\n';
    if (q.answer_1) answerText += '-- Solution 1:\n' + q.answer_1.trim() + '\n\n';
    if (q.answer_2) answerText += '-- Solution 2:\n' + q.answer_2.trim() + '\n\n';
    if (q.explanation) answerText += '-- Explanation:\n' + q.explanation.trim();

    document.getElementById('answerBox').textContent = answerText || '-- No answer provided --';

    // update counter
    document.getElementById('questionCounter').textContent = `Question ${index+1} of ${questions.length}`;
}

/* Navigation buttons */
document.getElementById('prevBtn').addEventListener('click', () => {
    if (currentQuestion > 0) {
        currentQuestion--;
        renderQuestion(currentQuestion);
    }
});
document.getElementById('nextBtn').addEventListener('click', () => {
    if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        renderQuestion(currentQuestion);
    }
});

/* Initialize UI */
createJumpButtons();
renderQuestion(0);

</script>
</body>
</html>
