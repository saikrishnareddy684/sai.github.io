<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SQL MCQ Exam – Batch + Resume + Timers + Scores</title>

<style>
:root{--bg:#f4f4f4;--card:#fff;--accent:#007bff;--good:#28a745;--bad:#dc3545;--muted:#666}
body{font-family:Inter,Arial;background:var(--bg);margin:0;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;padding:18px;border-radius:10px}
button{padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
.primary{background:var(--accent);color:#fff}
.secondary{background:#6c757d;color:#fff}
.warn{background:#ffc107}
.danger{background:var(--bad);color:#fff}
.batch-btn{min-width:220px;padding:12px;border-radius:8px;font-weight:600}
.batch-wrap{display:flex;gap:12px;flex-wrap:wrap}
.small{font-size:0.9rem;color:#666}
.dark{background:#121214;color:#e6eef8}
</style>
</head>

<body>
<div class="container">
<h1>SQL MCQ Exam — Batch Mode</h1>

<div id="menu"></div>
<div id="exam" style="display:none"></div>
<div id="result"></div>
</div>

<script>
/* ---------------- CONFIG ---------------- */
const QUESTIONS_PER_BATCH = 5;
const PER_QUESTION_SECONDS = 20;
const LS_KEY = 'mcq_exam_state';
const COMPLETED_KEY = 'mcq_completed_batches';
const SCORES_KEY = 'mcq_batch_scores';

/* ---------------- QUESTIONS ---------------- */
let originalQuestions = [
  {
    "q": "Which SQL command is used to retrieve data from a database table?",
    "options": [
      "GET",
      "FETCH",
      "SELECT",
      "OPEN TABLE"
    ],
    "answer": 2,
    "time": 20
  },
  {
    "q": "Which SQL clause is used to filter rows based on a specific condition?",
    "options": [
      "CONDITION",
      "FILTER BY",
      "WHERE",
      "LIMIT TO"
    ],
    "answer": 2,
    "time": 20
  },
  {
    "q": "Which SQL command is used to insert new rows into a table?",
    "options": [
      "ADD ROW",
      "INSERT INTO",
      "CREATE RECORD",
      "UPDATE"
    ],
    "answer": 1,
    "time": 20
  },
  {
    "q": "What does the acronym SQL stand for?",
    "options": [
      "Structured Question Language",
      "Standard Query Logic",
      "Simple Query Language",
      "Structured Query Language"
    ],
    "answer": 3,
    "time": 20
  },
  {
    "q": "Which operator is used to search for a specific pattern in a column?",
    "options": [
      "PATTERN",
      "LIKE",
      "MATCH",
      "COMPARE"
    ],
    "answer": 1,
    "time": 20
  },
  {
    "q": "Which type of JOIN returns only the rows with matching values in both tables?",
    "options": [
      "FULL JOIN",
      "LEFT JOIN",
      "INNER JOIN",
      "OUTER JOIN"
    ],
    "answer": 2,
    "time": 20
  },
  {
    "q": "Which SQL command is used to modify existing data in a table?",
    "options": [
      "MODIFY",
      "CHANGE",
      "ALTER",
      "UPDATE"
    ],
    "answer": 3,
    "time": 20
  },
  {
    "q": "Which SQL keyword is used to sort the result-set of a query?",
    "options": [
      "SORT BY",
      "ARRANGE BY",
      "GROUP BY",
      "ORDER BY"
    ],
    "answer": 3,
    "time": 20
  }
];

/* ---------------- STATE ---------------- */
let completedBatches = JSON.parse(localStorage.getItem(COMPLETED_KEY) || "[]");
let batchScores = JSON.parse(localStorage.getItem(SCORES_KEY) || "{}");

/* ---------------- MENU ---------------- */
function renderBatchMenu(){
  const menu = document.getElementById('menu');
  menu.innerHTML = "<h3>Select Batch</h3>";

  const total = Math.ceil(originalQuestions.length / QUESTIONS_PER_BATCH);
  const wrap = document.createElement('div');
  wrap.className = 'batch-wrap';

  for(let b=0;b<total;b++){
    const btn = document.createElement('button');
    btn.className = 'batch-btn';

    if(completedBatches.includes(b)){
      const s = batchScores[b];
      btn.style.background = 'var(--good)';
      btn.style.color = '#fff';
      btn.innerHTML = `
        Batch ${b+1} ✅<br>
        <span class="small">Score: ${s.correct}/${s.total} (${s.pct}%)</span>
      `;
    } else {
      btn.classList.add('primary');
      btn.textContent = `Start Batch ${b+1}`;
    }

    btn.onclick = ()=>startBatch(b);
    wrap.appendChild(btn);
  }

  menu.appendChild(wrap);
}

/* ---------------- EXAM ---------------- */
let questions=[], answers=[], index=0;

function startBatch(batchIndex){
  document.getElementById('menu').style.display='none';
  document.getElementById('exam').style.display='block';

  const start = batchIndex * QUESTIONS_PER_BATCH;
  const end = Math.min(start+QUESTIONS_PER_BATCH, originalQuestions.length);
  questions = originalQuestions.slice(start,end);
  answers = new Array(questions.length).fill(null);
  index = 0;

  renderQuestion(batchIndex);
}

function renderQuestion(batchIndex){
  const q = questions[index];
  let html = `<h3>Q${index+1}. ${q.q}</h3>`;

  q.options.forEach((o,i)=>{
    html += `<label><input type="radio" name="opt" value="${i}"
      ${answers[index]===i?'checked':''}> ${o}</label><br>`;
  });

  html += `
    <br>
    <button onclick="prevQ()">Prev</button>
    <button onclick="nextQ(${batchIndex})">Next</button>
    <button class="danger" onclick="submitBatch(${batchIndex})">Submit</button>
  `;

  document.getElementById('exam').innerHTML = html;

  document.querySelectorAll("input[name='opt']").forEach(r=>{
    r.onchange=()=>answers[index]=parseInt(r.value);
  });
}

function nextQ(b){ if(index<questions.length-1){index++;renderQuestion(b);} }
function prevQ(){ if(index>0){index--;renderQuestion();} }

/* ---------------- SUBMIT ---------------- */
function submitBatch(batchIndex){
  let correct=0;
  questions.forEach((q,i)=>{ if(answers[i]===q.answer) correct++; });
  const total=questions.length;
  const pct=((correct/total)*100).toFixed(2);

  completedBatches.push(batchIndex);
  completedBatches=[...new Set(completedBatches)];
  localStorage.setItem(COMPLETED_KEY,JSON.stringify(completedBatches));

  batchScores[batchIndex]={correct,total,pct};
  localStorage.setItem(SCORES_KEY,JSON.stringify(batchScores));

  document.getElementById('exam').style.display='none';
  document.getElementById('result').innerHTML=`
    <h2>Batch ${batchIndex+1} Result</h2>
    <p>Score: ${correct}/${total} (${pct}%)</p>
    <button onclick="location.reload()">Back to Menu</button>
  `;
}

/* ---------------- INIT ---------------- */
renderBatchMenu();
</script>
</body>
</html>
