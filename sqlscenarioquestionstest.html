<script>
    let currentQuestion = 0;

    const questions = [

        /* ----------------------------------------------------------
           QUESTION 1 ‚Äî Employee Visit Tracking
           ---------------------------------------------------------- */
        {
            question: `
A company tracks employee visits... (same as before)
`,
            dataset: [
                {name:"Alice", email:"a1@mail.com", floor:2, resources:"Laptop"},
                {name:"Alice", email:"a2@mail.com", floor:2, resources:"Projector"},
                {name:"Bob", email:"bob@mail.com", floor:1, resources:"Printer"},
                {name:"Alice", email:"a1@mail.com", floor:3, resources:"Laptop"},
                {name:"Bob", email:"bob2@mail.com", floor:1, resources:"Laptop"},
                {name:"Charlie", email:"charlie@mail.com", floor:2, resources:"Laptop"},
                {name:"Charlie", email:"charlie@mail.com", floor:2, resources:"Projector"},
                {name:"Alice", email:"a2@mail.com", floor:2, resources:"Whiteboard"}
            ],
            answer: `
WITH floor_rank AS (... same as before)
`
        },

        /* ----------------------------------------------------------
           QUESTION 2 ‚Äî Team Match Results (Merged XML Scenario)
           ---------------------------------------------------------- */
        {
            question: `
Using the match result dataset, write a SQL query to:

1. Total matches played  
2. Total wins  
3. Total losses  
4. Display team_name, matches_played, wins, losses  
5. Order by wins desc  
`,
            dataset: [
                {Team_1:"India", Team_2:"SL", Winner:"India"},
                {Team_1:"SL", Team_2:"Aus", Winner:"Aus"},
                {Team_1:"SA", Team_2:"Eng", Winner:"Eng"},
                {Team_1:"Eng", Team_2:"NZ", Winner:"NZ"},
                {Team_1:"Aus", Team_2:"India", Winner:"India"}
            ],

            /* ‚≠ê NEW: Expected Output dataset added */
            output: [
                {Team_Name:"India", Matches_played:2, no_of_wins:2, no_of_losses:0},
                {Team_Name:"SL", Matches_played:2, no_of_wins:0, no_of_losses:2},
                {Team_Name:"SA", Matches_played:1, no_of_wins:0, no_of_losses:1},
                {Team_Name:"Eng", Matches_played:2, no_of_wins:1, no_of_losses:1},
                {Team_Name:"Aus", Matches_played:2, no_of_wins:1, no_of_losses:1},
                {Team_Name:"NZ", Matches_played:1, no_of_wins:1, no_of_losses:0}
            ],

            answer: `
WITH team_name AS (
   SELECT team_name, COUNT(*) matches_played FROM (
       SELECT Team_1 AS team_name FROM MatchResults
       UNION ALL
       SELECT Team_2 FROM MatchResults
   ) a GROUP BY team_name
),
no_of_wins AS (
    SELECT team_name, SUM(no_of_wins) AS no_of_wins FROM (
        SELECT Team_1 AS team_name,
               SUM(CASE WHEN Team_1 = Winner THEN 1 ELSE 0 END) AS no_of_wins
        FROM MatchResults GROUP BY Team_1

        UNION ALL

        SELECT Team_2 AS team_name,
               SUM(CASE WHEN Team_2 = Winner THEN 1 ELSE 0 END) AS no_of_wins
        FROM MatchResults GROUP BY Team_2
    ) a GROUP BY team_name
)
SELECT 
    a.team_name,
    a.matches_played,
    b.no_of_wins,
    a.matches_played - b.no_of_wins AS no_of_losses
FROM team_name a
JOIN no_of_wins b ON a.team_name = b.team_name
ORDER BY b.no_of_wins DESC;
`
        }

        /* ----------------------------------------------------------
           üëâ COMMENT: Add more questions here
           ---------------------------------------------------------- */
    ];

    function renderTable(data) {
        let html = "<table><tr>";
        Object.keys(data[0]).forEach(col => html += `<th>${col}</th>`);
        html += "</tr>";

        data.forEach(row => {
            html += "<tr>";
            Object.values(row).forEach(val => html += `<td>${val}</td>`);
            html += "</tr>";
        });

        return html + "</table>";
    }

    function renderQuestion(index) {
        let q = questions[index];

        document.getElementById("questionBox").innerHTML = `<p>${q.question}</p>`;
        document.getElementById("datasetBox").innerHTML = renderTable(q.dataset);

        // ‚≠ê New - If output exists, render it
        if (q.output) {
            document.getElementById("outputBox").innerHTML =
                "<h3>Expected Output</h3>" + renderTable(q.output);
        } else {
            document.getElementById("outputBox").innerHTML = "";
        }

        document.getElementById("answerBox").innerText = q.answer;
    }

    function nextQuestion() {
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            renderQuestion(currentQuestion);
        } else alert("This is the last question.");
    }

    function previousQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            renderQuestion(currentQuestion);
        } else alert("This is the first question.");
    }

    window.onload = function() {
        renderQuestion(currentQuestion);
    }
</script>
