<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SQL Question & Answer â€” Full</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #222;
        }
        .container {
            width: 95%;
            max-width: 1100px;
            margin: 0 auto;
        }
        h1 { margin: 0 0 8px; font-size: 22px; }
        h2 { margin: 18px 0 6px; font-size: 18px; color: #333; }
        h3 { margin: 8px 0; font-size: 16px; color: #333; }
        .box {
            background: white;
            padding: 18px;
            margin-top: 14px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.06);
        }
        .jump-buttons {
            margin-bottom: 12px;
        }
        .jump-buttons button {
            background-color: #008CBA;
            color: white;
            border: none;
            padding: 8px 12px;
            margin-right: 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        .jump-buttons button:hover { background-color: #007399; }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }
        table, th, td { border: 1px solid #ddd; }
        th, td { padding: 8px; text-align: left; font-size: 13px; }
        th { background: #fafafa; }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 14px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.45;
        }
        .nav-buttons {
            margin-top: 14px;
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }
        .nav-controls button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        .nav-controls button:hover { background-color: #45a049; }
        .small-muted { color: #666; font-size: 13px; margin-top: 6px; }
    </style>
</head>
<body>
<div class="container">
    <h1>ðŸ“š SQL Questions & Answers</h1>
    <div class="small-muted">Click any question button to jump directly to that question. Buttons are auto-generated from the `questions` array â€” add new question objects there and a button appears automatically.</div>

    <!-- Jump buttons (auto-generated) -->
    <div id="jumpButtons" class="jump-buttons"></div>

    <!-- Question area -->
    <div id="questionBox" class="box"></div>

    <h3>Sample Dataset</h3>
    <div id="datasetBox" class="box"></div>

    <h3>Expected Output</h3>
    <div id="outputBox" class="box"></div>

    <h2>ðŸŸ¢ SQL Answer</h2>
    <div class="box">
        <pre id="answerBox"></pre>
    </div>

    <div class="nav-buttons">
        <div class="nav-controls">
            <button id="prevBtn">â¬… Previous</button>
            <button id="nextBtn">Next âž¡</button>
        </div>
        <div class="small-muted" id="questionCounter"></div>
    </div>
</div>

<script>
/* ============================
   QUESTIONS ARRAY (6 questions)
   Keep the same object format when adding new questions.
   Buttons will be generated automatically.
   ============================ */
const questions = [

/* QUESTION 1 â€” Employee Visit Tracking */
{
    question: `
A company tracks employee visits, allowing only one entry per employee per day.
A loophole allows multiple entries using different email IDs.

Determine:
- Total visits
- Most visited floor
- Distinct resources used

Output columns: Name, Total Visits, Most Visited Floor, Used Resources.
`,
    dataset: [
        {name:"A    ", address:"Bangalore", email:"A@gmail.com  ", floor:"1    ", resources:"CPU     "},
        {name:"A    ", address:"Bangalore", email:"A1@gmail.com ", floor:"1    ", resources:"CPU     "},
        {name:"A    ", address:"Bangalore", email:"A2@gmail.com ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B@gmail.com  ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B1@gmail.com ", floor:"2    ", resources:"DESKTOP "},
        {name:"B    ", address:"Bangalore", email:"B2@gmail.com ", floor:"1    ", resources:"MONITOR "}
    ],
    output: [
        {name:"A    ", total_visits:"3", most_visited_floor:"1    ", resources_used:"CPU,DESKTOP   "},
        {name:"B    ", total_visits:"3", most_visited_floor:"2    ", resources_used:"DESKTOP,MONITOR"}
    ],
    answer: `
WITH floor_rank AS (
    SELECT 
        name,
        floor,
        COUNT(*) AS floor_visit_count,
        RANK() OVER (PARTITION BY name ORDER BY COUNT(*) DESC) AS rn
    FROM resources_data
    GROUP BY name, floor
),
distinct_resources AS (
    SELECT DISTINCT name, resources 
    FROM resources_data
),
resource_list AS (
    SELECT name, STRING_AGG(resources, ',') AS used_resources
    FROM distinct_resources
    GROUP BY name
),
total_visits AS (
    SELECT name, COUNT(*) AS total_visits
    FROM resources_data
    GROUP BY name
)
SELECT 
    FR.name,
    TV.total_visits,
    FR.floor AS most_visited_floor,
    RL.used_resources
FROM floor_rank FR
JOIN total_visits TV ON FR.name = TV.name
JOIN resource_list RL ON FR.name = RL.name
WHERE FR.rn = 1;
`
},

/* QUESTION 2 â€” Team Match Results */
{
    question: `
Using the match result dataset, write a SQL query to:

1. Total matches played  
2. Total wins  
3. Total losses  
4. Display team_name, matches_played, wins, losses  
5. Order by wins desc  
`,
    dataset: [
        {Team_1:"India", Team_2:"SL", Winner:"India"},
        {Team_1:"SL", Team_2:"Aus", Winner:"Aus"},
        {Team_1:"SA", Team_2:"Eng", Winner:"Eng"},
        {Team_1:"Eng", Team_2:"NZ", Winner:"NZ"},
        {Team_1:"Aus", Team_2:"India", Winner:"India"}
    ],
    output: [
        {Team_Name:"India", Matches_played:2, no_of_wins:2, no_of_losses:0},
        {Team_Name:"SL", Matches_played:2, no_of_wins:0, no_of_losses:2},
        {Team_Name:"SA", Matches_played:1, no_of_wins:0, no_of_losses:1},
        {Team_Name:"Eng", Matches_played:2, no_of_wins:1, no_of_losses:1},
        {Team_Name:"Aus", Matches_played:2, no_of_wins:1, no_of_losses:1},
        {Team_Name:"NZ", Matches_played:1, no_of_wins:1, no_of_losses:0}
    ],
    answer: `
WITH team_name AS (
   SELECT team_name, COUNT(*) matches_played FROM (
       SELECT Team_1 AS team_name FROM MatchResults
       UNION ALL
       SELECT Team_2 FROM MatchResults
   ) a GROUP BY team_name
),
no_of_wins AS (
    SELECT team_name, SUM(no_of_wins) AS no_of_wins FROM (
        SELECT Team_1 AS team_name,
               SUM(CASE WHEN Team_1 = Winner THEN 1 ELSE 0 END) AS no_of_wins
        FROM MatchResults GROUP BY Team_1

        UNION ALL

        SELECT Team_2 AS team_name,
               SUM(CASE WHEN Team_2 = Winner THEN 1 ELSE 0 END) AS no_of_wins
        FROM MatchResults GROUP BY Team_2
    ) a GROUP BY team_name
)
SELECT 
    a.team_name,
    a.matches_played,
    b.no_of_wins,
    a.matches_played - b.no_of_wins AS no_of_losses
FROM team_name a
JOIN no_of_wins b ON a.team_name = b.team_name
ORDER BY b.no_of_wins DESC;
`
},

/* QUESTION 3 â€” Daily New vs Repeat Customers */
{
    question: `
Given the daily orders dataset, write a SQL query to determine:

1. How many customers are NEW on each order date  
2. How many customers are REPEAT on each order date  
3. Display order_date, first_visit_flag (new customers), repeat_visit_flag (repeat customers)  
4. Order the results by order_date  
`,
    dataset: [
        {order_id:1, customer_id:100, order_date:"2022-01-01", order_amount:2000},
        {order_id:2, customer_id:200, order_date:"2022-01-01", order_amount:2500},
        {order_id:3, customer_id:300, order_date:"2022-01-01", order_amount:2100},
        {order_id:4, customer_id:100, order_date:"2022-01-02", order_amount:2000},
        {order_id:5, customer_id:400, order_date:"2022-01-02", order_amount:2200},
        {order_id:6, customer_id:500, order_date:"2022-01-02", order_amount:2700},
        {order_id:7, customer_id:100, order_date:"2022-01-03", order_amount:3000},
        {order_id:8, customer_id:400, order_date:"2022-01-03", order_amount:1000},
        {order_id:9, customer_id:600, order_date:"2022-01-03", order_amount:3000}
    ],
    output: [
        {order_date:"2022-01-01", first_visit_flag:3, repeat_visit_flag:0},
        {order_date:"2022-01-02", first_visit_flag:2, repeat_visit_flag:1},
        {order_date:"2022-01-03", first_visit_flag:1, repeat_visit_flag:2}
    ],
    answer: `
SELECT 
    a.order_date,
    SUM(CASE WHEN b.customer_id IS NOT NULL THEN 1 ELSE 0 END) AS first_visit_flag,
    SUM(CASE WHEN b.customer_id IS NULL THEN 1 ELSE 0 END) AS repeat_visit_flag
FROM orders a
LEFT JOIN (
    SELECT customer_id, MIN(order_date) AS first_order_date
    FROM orders
    GROUP BY customer_id
) b 
ON a.customer_id = b.customer_id
AND a.order_date = b.first_order_date
GROUP BY a.order_date
ORDER BY a.order_date;
`
},

/* QUESTION 4 â€” Daily Revenue (New vs Repeat) */
{
    question: `
Extend the previous analysis to compute:

1. New customer count per day  
2. Repeat customer count per day  
3. Revenue by new customers  
4. Revenue by repeat customers  
`,
    dataset: [
        {order_id:1, customer_id:100, order_date:"2022-01-01", order_amount:2000},
        {order_id:2, customer_id:200, order_date:"2022-01-01", order_amount:2500},
        {order_id:3, customer_id:300, order_date:"2022-01-01", order_amount:2100},
        {order_id:4, customer_id:100, order_date:"2022-01-02", order_amount:2000},
        {order_id:5, customer_id:400, order_date:"2022-01-02", order_amount:2200},
        {order_id:6, customer_id:500, order_date:"2022-01-02", order_amount:2700},
        {order_id:7, customer_id:100, order_date:"2022-01-03", order_amount:3000},
        {order_id:8, customer_id:400, order_date:"2022-01-03", order_amount:1000},
        {order_id:9, customer_id:600, order_date:"2022-01-03", order_amount:3000}
    ],
    output: [
        {order_date:"2022-01-01", first_visit:3, repeat_visit:0, new_customer_amount:6600, old_customer_amount:0},
        {order_date:"2022-01-02", first_visit:2, repeat_visit:1, new_customer_amount:4900, old_customer_amount:2000},
        {order_date:"2022-01-03", first_visit:1, repeat_visit:2, new_customer_amount:3000, old_customer_amount:4000}
    ],
    answer: `
WITH first_order AS (
    SELECT customer_id, MIN(order_date) AS first_order_date
    FROM orders
    GROUP BY customer_id
),
visits AS (
    SELECT 
        a.order_date,
        SUM(CASE WHEN a.order_date = b.first_order_date THEN 1 ELSE 0 END) AS first_visit,
        SUM(CASE WHEN a.order_date <> b.first_order_date THEN 1 ELSE 0 END) AS repeat_visit
    FROM orders a
    JOIN first_order b
        ON a.customer_id = b.customer_id
    GROUP BY a.order_date
),
amount AS (
    SELECT 
        a.order_date,
        SUM(CASE WHEN a.order_date = b.first_order_date THEN order_amount ELSE 0 END) AS new_customer_amount,
        SUM(CASE WHEN a.order_date <> b.first_order_date THEN order_amount ELSE 0 END) AS old_customer_amount
    FROM orders a
    JOIN first_order b
        ON a.customer_id = b.customer_id
    GROUP BY a.order_date
)
SELECT 
    v.order_date,
    v.first_visit,
    v.repeat_visit,
    a.new_customer_amount,
    a.old_customer_amount
FROM visits v
JOIN amount a ON v.order_date = a.order_date
ORDER BY v.order_date;
`
},

/* QUESTION 5 â€” Nth Future Sunday */
{
    question: `
Write a SQL query to find the date of the Nth occurrence of Sunday in the future from a given starting date.

Provide two solutions:
1. Using a date generator (loop or recursive method)
2. Using a direct mathematical formula

Also explain why (n - 1) and (8 - weekday) are used.
`,
    dataset: [],
    output: [],
    answer_1: `
-- Approach 1: Using date generation (loop)

DROP TABLE IF EXISTS ##date_list;

CREATE TABLE ##date_list (dt DATE);

DECLARE @startdate DATE = CONVERT(DATE, GETDATE());
DECLARE @enddate DATE = DATEADD(WEEK, 10, @startdate);
DECLARE @dt DATE = @startdate;

WHILE @dt <= @enddate
BEGIN
    INSERT INTO ##date_list VALUES (@dt);
    SET @dt = DATEADD(DAY, 1, @dt);
END;

DECLARE @n INT = 3, @weekday VARCHAR(10) = 'Sunday';

SELECT TOP 1 dt
FROM (
    SELECT dt,
           DATENAME(WEEKDAY, dt) AS weekday,
           ROW_NUMBER() OVER (PARTITION BY DATENAME(WEEKDAY, dt) ORDER BY dt) AS rn
    FROM ##date_list
) x
WHERE weekday = @weekday AND rn = @n
ORDER BY dt;
`,
    answer_2: `
-- Approach 2: Direct mathematical formula

DECLARE @today_date DATE = CONVERT(DATE, GETDATE());
DECLARE @n INT = 3;

SELECT DATEADD(
           WEEK, @n - 1,
           DATEADD(DAY, 8 - DATEPART(WEEKDAY, @today_date), @today_date)
       ) AS nth_future_sunday;
`,
    explanation: `
Explanation:

1. DATEPART(WEEKDAY, @today_date)
   Returns 1â€“7 (Sundayâ€“Saturday).

2. (8 - weekday):
   Gives number of days until next Sunday.

3. (n - 1):
   1st Sunday â†’ +0 weeks
   2nd Sunday â†’ +1 week
   3rd Sunday â†’ +2 weeks
   Nth Sunday â†’ (n - 1) additional weeks.
`
},

/* QUESTION 6 â€” Order Shipping Analysis */
{
    question: `
Given the below order dataset with columns (order_id, customer_id, order_date, ship_date),
calculate the following for each order:

1. days_to_ship  â†’ Total days between order_date and ship_date  
2. week_between_days â†’ Number of complete weeks between the dates  
3. business_days_to_ship â†’ Count of business days (Monâ€“Fri), excluding weekends

Return all columns including the calculated ones.
`,
    dataset: [
        {order_id:"1000", customer_id:"1", order_date:"2022-01-05", ship_date:"2022-01-11"},
        {order_id:"1001", customer_id:"2", order_date:"2022-02-04", ship_date:"2022-02-16"},
        {order_id:"1002", customer_id:"3", order_date:"2022-01-01", ship_date:"2022-01-19"},
        {order_id:"1003", customer_id:"4", order_date:"2022-01-06", ship_date:"2022-01-30"},
        {order_id:"1004", customer_id:"1", order_date:"2022-02-07", ship_date:"2022-02-13"},
        {order_id:"1005", customer_id:"4", order_date:"2022-01-07", ship_date:"2022-01-31"},
        {order_id:"1006", customer_id:"3", order_date:"2022-02-08", ship_date:"2022-02-26"},
        {order_id:"1007", customer_id:"2", order_date:"2022-02-09", ship_date:"2022-02-21"},
        {order_id:"1008", customer_id:"4", order_date:"2022-02-10", ship_date:"2022-03-06"}
    ],
    output: [
        {order_id:"1000", customer_id:"1", order_date:"2022-01-05", ship_date:"2022-01-11", days_to_ship:"6",  week_between_days:"1", business_days_to_ship:"4"},
        {order_id:"1001", customer_id:"2", order_date:"2022-02-04", ship_date:"2022-02-16", days_to_ship:"12", week_between_days:"2", business_days_to_ship:"8"},
        {order_id:"1002", customer_id:"3", order_date:"2022-01-01", ship_date:"2022-01-19", days_to_ship:"18", week_between_days:"3", business_days_to_ship:"12"},
        {order_id:"1003", customer_id:"4", order_date:"2022-01-06", ship_date:"2022-01-30", days_to_ship:"24", week_between_days:"4", business_days_to_ship:"16"},
        {order_id:"1004", customer_id:"1", order_date:"2022-02-07", ship_date:"2022-02-13", days_to_ship:"6",  week_between_days:"1", business_days_to_ship:"4"},
        {order_id:"1005", customer_id:"4", order_date:"2022-01-07", ship_date:"2022-01-31", days_to_ship:"24", week_between_days:"4", business_days_to_ship:"16"},
        {order_id:"1006", customer_id:"3", order_date:"2022-02-08", ship_date:"2022-02-26", days_to_ship:"18", week_between_days:"2", business_days_to_ship:"14"},
        {order_id:"1007", customer_id:"2", order_date:"2022-02-09", ship_date:"2022-02-21", days_to_ship:"12", week_between_days:"2", business_days_to_ship:"8"},
        {order_id:"1008", customer_id:"4", order_date:"2022-02-10", ship_date:"2022-03-06", days_to_ship:"24", week_between_days:"4", business_days_to_ship:"16"}
    ],
    answer: `
SELECT
    order_id,
    customer_id,
    order_date,
    ship_date,

    -- 1. Total days between the dates
    DATEDIFF(day, order_date, ship_date) AS days_to_ship,

    -- 2. Number of complete weeks between dates
    DATEDIFF(week, order_date, ship_date) AS week_between_days,

    -- 3. Business days between dates (Monâ€“Fri)
    (
        (DATEDIFF(day, order_date, ship_date) + 1)                  -- total days inclusive
        - 2 * (DATEDIFF(week, order_date, ship_date))              -- remove Saturdays & Sundays
        - CASE WHEN DATENAME(weekday, order_date) = 'Sunday' THEN 1 ELSE 0 END
        - CASE WHEN DATENAME(weekday, ship_date) = 'Saturday' THEN 1 ELSE 0 END
    ) AS business_days_to_ship

FROM orders_data;
`
}
    ,
    {
    question: `
A company wants to identify the key products contributing to most of its revenue
using the Pareto Principle (80/20 Rule).

Determine:
- Total sales per product
- Running cumulative sales (highest to lowest)
- Products that together contribute to 80% of total sales

Output columns:
Product_ID, Product_Sales, Running_Sales, Total_Sales_80_Percent
`,
    dataset: [
        {product_id:"P1", sales:5000},
        {product_id:"P2", sales:3000},
        {product_id:"P3", sales:2000},
        {product_id:"P4", sales:1500},
        {product_id:"P5", sales:1000},
        {product_id:"P6", sales:800},
        {product_id:"P7", sales:700},
        {product_id:"P8", sales:500}
    ],
    output: [
        {product_id:"P1", product_sales:5000, running_sales:5000, total_sales_80_percent:11200},
        {product_id:"P2", product_sales:3000, running_sales:8000, total_sales_80_percent:11200},
        {product_id:"P3", product_sales:2000, running_sales:10000, total_sales_80_percent:11200},
        {product_id:"P4", product_sales:1500, running_sales:11500, total_sales_80_percent:11200}
    ],
    answer: `
WITH product_sales AS (
    SELECT 
        product_id,
        SUM(sales) AS product_sales
    FROM orders
    GROUP BY product_id
),
running_totals AS (
    SELECT *,
           SUM(product_sales) OVER (
               ORDER BY product_sales DESC
               ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
           ) AS running_sales,
           0.8 * SUM(product_sales) OVER () AS total_sales_80_percent
    FROM product_sales
)
SELECT 
    product_id,
    product_sales,
    running_sales,
    total_sales_80_percent
FROM running_totals
WHERE running_sales <= total_sales_80_percent;
`
},
    {
    question: `
Given two tables:
1) PersonScores (person details and scores)
2) PersonFriends (person to friend mapping)

Write a query to find:
- Person ID
- Person Name
- Number of friends
- Total score of all their friends

Return only those persons whose friends' total score is greater than 100.

Output columns:
PersonID, Total_Friend_Score, No_Of_Friends, Person_Name
`,
    dataset: {
        PersonScores: [
            {PersonID:1, Name:"Alice", Email:"alice2018@hotmail.com", Score:88},
            {PersonID:2, Name:"Bob",   Email:"bob2018@hotmail.com",   Score:11},
            {PersonID:3, Name:"Davis", Email:"davis2018@hotmail.com", Score:27},
            {PersonID:4, Name:"Tara",  Email:"tara2018@hotmail.com",  Score:45},
            {PersonID:5, Name:"John",  Email:"john2018@hotmail.com",  Score:63}
        ],
        PersonFriends: [
            {PersonID:1, FriendID:2},
            {PersonID:1, FriendID:3},
            {PersonID:2, FriendID:1},
            {PersonID:2, FriendID:3},
            {PersonID:3, FriendID:5},
            {PersonID:4, FriendID:2},
            {PersonID:4, FriendID:3},
            {PersonID:4, FriendID:5}
        ]
    },
    output: [
        {personid:2, total_friend_score:115, no_of_friends:2, person_name:"Bob"},
        {personid:4, total_friend_score:101, no_of_friends:3, person_name:"Tara"}
    ],
    answer: `
SELECT a.PersonID,
       a.total_friend_score,
       a.no_of_friends,
       p.Name AS person_name
FROM (
    SELECT 
        f.PersonID,
        COUNT(f.FriendID) AS no_of_friends,
        SUM(ps.Score) AS total_friend_score
    FROM PersonFriends f
    JOIN PersonScores ps
        ON ps.PersonID = f.FriendID
    GROUP BY f.PersonID
    HAVING SUM(ps.Score) > 100
) a
LEFT JOIN PersonScores p
    ON a.PersonID = p.PersonID;
`
}
,
     
{
    question: `
Find customers who placed orders in all months of 2024.

A customer qualifies only if they have at least one order
in every month (Januaryâ€“December) of the year 2024.

Output columns: Customer, Count_of_Months.
`,
    dataset: [
        {customer:"A", order_date:"2024-01-15", calmonth:"1"},
        {customer:"A", order_date:"2024-02-20", calmonth:"2"},
        {customer:"A", order_date:"2024-03-05", calmonth:"3"},
        {customer:"A", order_date:"2024-04-12", calmonth:"4"},
        {customer:"A", order_date:"2024-05-30", calmonth:"5"},
        {customer:"A", order_date:"2024-06-10", calmonth:"6"},
        {customer:"A", order_date:"2024-07-01", calmonth:"7"},
        {customer:"A", order_date:"2024-08-22", calmonth:"8"},
        {customer:"A", order_date:"2024-09-18", calmonth:"9"},
        {customer:"A", order_date:"2024-10-11", calmonth:"10"},
        {customer:"A", order_date:"2024-11-25", calmonth:"11"},
        {customer:"A", order_date:"2024-12-03", calmonth:"12"},

        {customer:"B", order_date:"2024-01-10", calmonth:"1"},
        {customer:"B", order_date:"2024-02-17", calmonth:"2"},
        {customer:"B", order_date:"2024-03-21", calmonth:"3"},
        {customer:"B", order_date:"2024-05-08", calmonth:"5"},
        {customer:"B", order_date:"2024-06-14", calmonth:"6"},

        {customer:"C", order_date:"2024-01-05", calmonth:"1"},
        {customer:"C", order_date:"2024-02-08", calmonth:"2"},
        {customer:"C", order_date:"2024-03-15", calmonth:"3"},
        {customer:"C", order_date:"2024-04-12", calmonth:"4"},
        {customer:"C", order_date:"2024-05-19", calmonth:"5"},
        {customer:"C", order_date:"2024-06-22", calmonth:"6"},
        {customer:"C", order_date:"2024-07-30", calmonth:"7"},
        {customer:"C", order_date:"2024-08-09", calmonth:"8"},
        {customer:"C", order_date:"2024-09-14", calmonth:"9"},
        {customer:"C", order_date:"2024-10-20", calmonth:"10"},
        {customer:"C", order_date:"2024-11-25", calmonth:"11"},
        {customer:"C", order_date:"2024-12-31", calmonth:"12"}
    ],
    output: [
        {customer:"A", count:"12"},
        {customer:"C", count:"12"}
    ],
    answer: `
WITH months_2024 AS (
    SELECT COUNT(DISTINCT calmonth) AS total_months
    FROM orders
    WHERE YEAR(order_date) = 2024
)
SELECT
    customer,
    COUNT(DISTINCT calmonth) AS count
FROM orders
WHERE YEAR(order_date) = 2024
GROUP BY customer
HAVING COUNT(DISTINCT calmonth) = (SELECT total_months FROM months_2024);
`
},
    {
    question: `
Explain SQL Performance Optimization Techniques.
The answer should be interview-ready, practical, and cover both query-level and database-level optimizations.
`,
    dataset: [
        { table: "orders", columns: ["order_id", "customer_id", "order_date", "amount"] },
        { table: "customers", columns: ["customer_id", "customer_name"] }
    ],
    output: [
        { area: "Indexing", focus: "JOIN, WHERE, ORDER BY columns" },
        { area: "Query Design", focus: "Filter early, avoid SELECT *" },
        { area: "Execution Plan", focus: "Remove scans, key lookups" }
    ],
    answer: `
-- SQL Performance Optimization Techniques

-- 1) Indexing (Most Important)
-- Create indexes on JOIN / WHERE / GROUP BY columns

CREATE INDEX idx_orders_customer_date
ON orders(customer_id, order_date);

-- Covering index to avoid key lookups
CREATE INDEX idx_orders_cover
ON orders(customer_id)
INCLUDE (order_date, amount);


-- 2) Query Design Best Practices
-- Avoid SELECT *
-- Filter early

SELECT customer_id, SUM(amount)
FROM orders
WHERE order_date >= '2024-01-01'
GROUP BY customer_id;

-- Avoid functions on indexed columns
-- BAD
-- WHERE YEAR(order_date) = 2024

-- GOOD
WHERE order_date >= '2024-01-01'
  AND order_date < '2025-01-01';


-- 3) Execution Plan Analysis
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
-- Check for table scans, key lookups, missing indexes


-- 4) Aggregation Before Join
WITH agg_orders AS (
    SELECT customer_id, SUM(amount) AS total_amount
    FROM orders
    GROUP BY customer_id
)
SELECT c.customer_name, a.total_amount
FROM agg_orders a
JOIN customers c
ON a.customer_id = c.customer_id;


-- 5) Data Types & Storage
-- Use INT over VARCHAR for numeric data
-- Use DATE instead of DATETIME if time not required


-- 6) Statistics & Index Maintenance
UPDATE STATISTICS orders;

ALTER INDEX ALL ON orders REBUILD;


-- 7) Partitioning (Large Tables)
-- Partition by date for pruning
PARTITION BY RANGE (order_date);


-- 8) Avoid Cursors & RBAR
-- Prefer set-based operations over row-by-row logic


-- 9) Temporary Objects
-- Use temp tables if reused multiple times
CREATE TABLE #temp_orders (...);


-- 10) Concurrency & Locking
-- Keep transactions short
-- Use NOLOCK only if dirty reads are acceptable


-- One-line Interview Answer:
-- SQL performance optimization focuses on proper indexing,
-- efficient query design, minimizing scans, and analyzing execution plans.
`
}
,
{
  question: "Find employees who earn more than the average salary of all employees.\n\nOutput columns:\nEmpID, Salary",

  dataset: [
    { EmpID: 1, Name: "Alice",   Department: "HR",        Salary: 50000 },
    { EmpID: 2, Name: "Bob",     Department: "IT",        Salary: 75000 },
    { EmpID: 3, Name: "Charlie", Department: "Finance",   Salary: 62000 },
    { EmpID: 4, Name: "Diana",   Department: "IT",        Salary: 80000 },
    { EmpID: 5, Name: "Ethan",   Department: "HR",        Salary: 48000 },
    { EmpID: 6, Name: "Fiona",   Department: "Marketing", Salary: 54000 },
    { EmpID: 7, Name: "George",  Department: "Finance",   Salary: 70000 }
  ],

  output: [
    { EmpID: 2, Salary: 75000 },
    { EmpID: 4, Salary: 80000 },
    { EmpID: 7, Salary: 70000 }
  ],

  answers: {
    version_1_subquery:
      "-- Version 1: Simple subquery (most common & interview-friendly)\n" +
      "SELECT EmpID, Salary\n" +
      "FROM Employees\n" +
      "WHERE Salary > (\n" +
      "    SELECT AVG(Salary)\n" +
      "    FROM Employees\n" +
      ");",

    version_2_window_function:
      "-- Version 2: Window function (clean & modern SQL)\n" +
      "SELECT EmpID, Salary\n" +
      "FROM (\n" +
      "    SELECT EmpID,\n" +
      "           Salary,\n" +
      "           AVG(Salary) OVER () AS avg_salary\n" +
      "    FROM Employees\n" +
      ") t\n" +
      "WHERE Salary > avg_salary;",

    version_3_aggregated_window:
      "-- Version 3: Aggregation + window function\n" +
      "-- Useful when employees may have multiple salary rows\n" +
      "SELECT EmpID, Salary\n" +
      "FROM (\n" +
      "    SELECT EmpID,\n" +
      "           Salary,\n" +
      "           AVG(Salary) OVER () AS avg_salary\n" +
      "    FROM (\n" +
      "        SELECT EmpID,\n" +
      "               SUM(Salary) AS Salary\n" +
      "        FROM Employees\n" +
      "        GROUP BY EmpID\n" +
      "    ) a\n" +
      ") b\n" +
      "WHERE Salary > avg_salary;"
  }
}



/* End of questions array */
];

/* ============================
   UI & Rendering Helpers
   ============================ */

let currentQuestion = 0;

function createJumpButtons() {
    const container = document.getElementById('jumpButtons');
    container.innerHTML = '';
    questions.forEach((q, idx) => {
        const btn = document.createElement('button');
        btn.textContent = 'Q' + (idx + 1);
        btn.title = 'Go to Question ' + (idx + 1);
        btn.onclick = () => {
            currentQuestion = idx;
            renderQuestion(idx);
        };
        container.appendChild(btn);
    });
}

function renderTableFromObjects(list) {
    if (!list || list.length === 0) return '';
    const cols = Object.keys(list[0]);
    let html = '<table><thead><tr>';
    cols.forEach(c => html += `<th>${c}</th>`);
    html += '</tr></thead><tbody>';
    list.forEach(r => {
        html += '<tr>';
        cols.forEach(c => html += `<td>${r[c]}</td>`);
        html += '</tr>';
    });
    html += '</tbody></table>';
    return html;
}

function renderQuestion(index) {
    const q = questions[index];
    // Question text
    document.getElementById('questionBox').innerHTML = `<h3>Question ${index + 1}</h3><p>${q.question.replace(/\n\s+/g,'\n')}</p>`;

    // Dataset
    const datasetHtml = q.dataset && q.dataset.length ? renderTableFromObjects(q.dataset) : '<p>No dataset for this question.</p>';
    document.getElementById('datasetBox').innerHTML = datasetHtml;

    // Output
    const outputHtml = q.output && q.output.length ? renderTableFromObjects(q.output) : '<p>No output for this question.</p>';
    document.getElementById('outputBox').innerHTML = outputHtml;

    // Answers: combine answer, answer_1, answer_2, explanation
    let answerText = '';
    if (q.answer) answerText += q.answer.trim() + '\n\n';
    if (q.answer_1) answerText += '-- Solution 1:\n' + q.answer_1.trim() + '\n\n';
    if (q.answer_2) answerText += '-- Solution 2:\n' + q.answer_2.trim() + '\n\n';
    if (q.explanation) answerText += '-- Explanation:\n' + q.explanation.trim();

    document.getElementById('answerBox').textContent = answerText || '-- No answer provided --';

    // update counter
    document.getElementById('questionCounter').textContent = `Question ${index+1} of ${questions.length}`;
}

/* Navigation buttons */
document.getElementById('prevBtn').addEventListener('click', () => {
    if (currentQuestion > 0) {
        currentQuestion--;
        renderQuestion(currentQuestion);
    }
});
document.getElementById('nextBtn').addEventListener('click', () => {
    if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        renderQuestion(currentQuestion);
    }
});

/* Initialize UI */
createJumpButtons();
renderQuestion(0);

</script>
</body>
</html>
